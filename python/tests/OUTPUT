============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-8.4.2, pluggy-1.5.0 -- /home/gharsha/miniconda3/envs/green-devel/bin/python
cachedir: .pytest_cache
rootdir: /home/gharsha/codes/green-grids
configfile: pyproject.toml
collecting ... collected 76 items

test_basis.py::ChebyshevBasisTest::test_bose_grid PASSED                 [  1%]
test_basis.py::ChebyshevBasisTest::test_bose_transform PASSED            [  2%]
test_basis.py::ChebyshevBasisTest::test_fermi_grid PASSED                [  3%]
test_basis.py::ChebyshevBasisTest::test_fermi_transform PASSED           [  5%]
test_basis.py::ChebyshevBasisTest::test_init PASSED                      [  6%]
test_basis.py::ChebyshevBasisTest::test_init_invalid_ncoeff PASSED       [  7%]
test_basis.py::ChebyshevBasisTest::test_init_notrim_and_raise PASSED     [  9%]
test_basis.py::ChebyshevBasisTest::test_init_trim_and_warn PASSED        [ 10%]
test_basis.py::IRBasisTest::test_bose_grid FAILED                        [ 11%]
test_basis.py::IRBasisTest::test_bose_transform FAILED                   [ 13%]
test_basis.py::IRBasisTest::test_fermi_grid FAILED                       [ 14%]
test_basis.py::IRBasisTest::test_fermi_transform FAILED                  [ 15%]
test_basis.py::IRBasisTest::test_init PASSED                             [ 17%]
test_basis.py::IRBasisTest::test_init_invalid_ncoeff PASSED              [ 18%]
test_basis.py::IRBasisTest::test_init_notrim_and_raise PASSED            [ 19%]
test_basis.py::IRBasisTest::test_init_trim_and_warn PASSED               [ 21%]
test_generator.py::GeneratorTest::test_call_bose PASSED                  [ 22%]
test_generator.py::GeneratorTest::test_call_fermi PASSED                 [ 23%]
test_generator.py::GeneratorTest::test_init PASSED                       [ 25%]
test_module_functions.py::ModuleFunctionsTest::test_get_fermi_bose_pair_chebyshev PASSED [ 26%]
test_module_functions.py::ModuleFunctionsTest::test_get_fermi_bose_pair_invalid_repn PASSED [ 27%]
test_module_functions.py::ModuleFunctionsTest::test_get_fermi_bose_pair_ir PASSED [ 28%]
test_module_functions.py::ModuleFunctionsTest::test_get_generator_chebyshev PASSED [ 30%]
test_module_functions.py::ModuleFunctionsTest::test_get_generator_invalid_repn PASSED [ 31%]
test_module_functions.py::ModuleFunctionsTest::test_get_generator_ir PASSED [ 32%]
test_module_functions.py::ModuleFunctionsTest::test_get_transformer_invalid_repn PASSED [ 34%]
test_module_functions.py::ModuleFunctionsTest::test_get_transformer_valid_repn PASSED [ 35%]
test_module_functions.py::ModuleFunctionsTest::test_transform_data_no_metadata PASSED [ 36%]
test_module_functions.py::ModuleFunctionsTest::test_transform_data_valid PASSED [ 38%]
test_module_functions.py::ModuleFunctionsTest::test_transform_paired_data_no_metadata PASSED [ 39%]
test_module_functions.py::ModuleFunctionsTest::test_transform_paired_data_valid PASSED [ 40%]
test_repn_transformer.py::SparseTransformerTest::test_init PASSED        [ 42%]
test_repn_transformer.py::SparseTransformerTest::test_scale_wgrid PASSED [ 43%]
test_repn_transformer.py::SparseTransformerTest::test_scale_xgrid PASSED [ 44%]
test_repn_transformer.py::SparseTransformerTest::test_transform_raises_if_no_metadata PASSED [ 46%]
test_repn_transformer.py::SparseTransformerTest::test_transform_raises_if_type_mismatch PASSED [ 47%]
test_repn_transformer.py::SparseTransformerTest::test_transform_return_new_data_if_no_beta PASSED [ 48%]
test_repn_transformer.py::SparseTransformerTest::test_transform_return_self_if_beta_matches PASSED [ 50%]
test_repn_transformer.py::SparseTransformerTest::test_transform_warns_if_beta_mismatch PASSED [ 51%]
test_repn_transformer.py::ChebyshevTransformerTest::test_init PASSED     [ 52%]
test_repn_transformer.py::ChebyshevTransformerTest::test_scale_fiw PASSED [ 53%]
test_repn_transformer.py::ChebyshevTransformerTest::test_scale_fx PASSED [ 55%]
test_repn_transformer.py::IRTransformerTest::test_init PASSED            [ 56%]
test_repn_transformer.py::IRTransformerTest::test_scale_fiw PASSED       [ 57%]
test_repn_transformer.py::IRTransformerTest::test_scale_fx PASSED        [ 59%]
test_sparse_data.py::SparseDataTest::test_init PASSED                    [ 60%]
test_sparse_data.py::SparseDataTest::test_init_invalid_ngrid_dim PASSED  [ 61%]
test_sparse_data.py::SparseDataTest::test_init_invalid_stats PASSED      [ 63%]
test_sparse_data.py::SparseDataTest::test_init_invalid_u1l_neg_shape PASSED [ 64%]
test_sparse_data.py::SparseDataTest::test_init_invalid_u1l_pos_shape PASSED [ 65%]
test_sparse_data.py::SparseDataTest::test_init_invalid_ulw_shape PASSED  [ 67%]
test_sparse_data.py::SparseDataTest::test_init_invalid_ulx_shape PASSED  [ 68%]
test_sparse_data.py::SparseDataTest::test_init_invalid_uwl_shape PASSED  [ 69%]
test_sparse_data.py::SparseDataTest::test_init_invalid_uxl_shape PASSED  [ 71%]
test_sparse_data.py::SparseDataTest::test_init_invalid_wgrid_dim PASSED  [ 72%]
test_sparse_data.py::SparseDataTest::test_init_invalid_xgrid_dim PASSED  [ 73%]
test_sparse_data.py::SparseDataTest::test_load_hdf5 PASSED               [ 75%]
test_sparse_data.py::SparseDataTest::test_load_hdf5_with_metadata PASSED [ 76%]
test_sparse_data.py::SparseDataTest::test_save_hdf5 PASSED               [ 77%]
test_sparse_data.py::SparseDataTest::test_save_hdf5_with_metadata PASSED [ 78%]
test_sparse_data.py::PairedSparseDataTest::test_init PASSED              [ 80%]
test_sparse_data.py::PairedSparseDataTest::test_init_identical_names PASSED [ 81%]
test_sparse_data.py::PairedSparseDataTest::test_init_invalid_name PASSED [ 82%]
test_sparse_data.py::PairedSparseDataTest::test_init_invalid_uxl_shape PASSED [ 84%]
test_sparse_data.py::PairedSparseDataTest::test_load_hdf5 PASSED         [ 85%]
test_sparse_data.py::PairedSparseDataTest::test_save_hdf5 PASSED         [ 86%]
test_transform.py::TransformTest::test_iw_to_l PASSED                    [ 88%]
test_transform.py::TransformTest::test_l_to_iw PASSED                    [ 89%]
test_transform.py::TransformTest::test_l_to_other_tau PASSED             [ 90%]
test_transform.py::TransformTest::test_l_to_tau PASSED                   [ 92%]
test_transform.py::TransformTest::test_l_to_tau_beta PASSED              [ 93%]
test_transform.py::TransformTest::test_l_to_tau_zero PASSED              [ 94%]
test_transform.py::TransformTest::test_tau_to_l PASSED                   [ 96%]
test_utils.py::UtilsTest::test_check_real PASSED                         [ 97%]
test_utils.py::UtilsTest::test_h5load_dict PASSED                        [ 98%]
test_utils.py::UtilsTest::test_h5save_dict PASSED                        [100%]

=================================== FAILURES ===================================
__________________________ IRBasisTest.test_bose_grid __________________________

self = <tests.test_basis.IRBasisTest testMethod=test_bose_grid>

    def test_bose_grid(self):
        basis = IRBasis(1e1, 3, 'bose')
        xgrid_expected = np.array([-8.971930e-01, 0.0, 8.971930e-01])
        wgrid_expected = np.array([-1, 0, 1], dtype=int)
    
>       assert_allclose(np.sort(basis.sampling_points_x()),
                        np.sort(xgrid_expected),
                        atol=1e-12)
E       AssertionError: 
E       Not equal to tolerance rtol=1e-07, atol=1e-12
E       
E       Mismatched elements: 2 / 3 (66.7%)
E       Max absolute difference among violations: 0.05855345
E       Max relative difference among violations: 0.06526294
E        ACTUAL: array([-0.83864,  0.     ,  0.83864])
E        DESIRED: array([-0.897193,  0.      ,  0.897193])

test_basis.py:158: AssertionError
_______________________ IRBasisTest.test_bose_transform ________________________

self = <tests.test_basis.IRBasisTest testMethod=test_bose_transform>

    def test_bose_transform(self):
        uxl_data_0 = [
            53.0330395953343, -53.0330396010825, 35.2351082797355,
            -35.2351085579774, 27.7300102274779, -27.7300150463786,
            23.1488795665343, -23.1489313987664, 19.9105082263949
        ]
        uxl_data_10 = [
            1.67201621220835e-05, 1.6714905012999e-05, -0.000593484301295908,
            -0.000593284323434273, 0.00718234433152259, 0.00717953428056469,
            -0.0489376157529712, -0.0489124370514369, 0.217033451984615
        ]
        uwl_data_8 = [
            0.0267773343787626, 0.00011984631703555j, -0.0444515093312776,
            -0.00100295468396756j, 0.0676847929082761, 0.00447541434393243j,
            -0.0953634348544582, -0.0147125670905463j, 0.122735156218375
        ]
    
        basis = IRBasis(1e4, 19, 'bose')
        xgrid = basis.sampling_points_x()
        wgrid = basis.sampling_points_matsubara()
        uxl = basis.uxl(np.arange(xgrid.shape[0]), xgrid)
        unl = basis.compute_unl(wgrid)
>       self.assertTrue(np.allclose(uxl[0, :9], uxl_data_0))
E       AssertionError: False is not true

test_basis.py:186: AssertionError
_________________________ IRBasisTest.test_fermi_grid __________________________

self = <tests.test_basis.IRBasisTest testMethod=test_fermi_grid>

    def test_fermi_grid(self):
        basis = IRBasis(1e1, 2, 'fermi')
        xgrid_expected = np.array([0.5, -0.5])
        wgrid_expected = np.array([-1, 0], dtype=int)
    
>       assert_allclose(np.sort(basis.sampling_points_x()),
                        np.sort(xgrid_expected),
                        atol=1e-12)
E       AssertionError: 
E       Not equal to tolerance rtol=1e-07, atol=1e-12
E       
E       Mismatched elements: 2 / 2 (100%)
E       Max absolute difference among violations: 0.20256985
E       Max relative difference among violations: 0.4051397
E        ACTUAL: array([-0.70257,  0.70257])
E        DESIRED: array([-0.5,  0.5])

test_basis.py:147: AssertionError
_______________________ IRBasisTest.test_fermi_transform _______________________

self = <tests.test_basis.IRBasisTest testMethod=test_fermi_transform>

    def test_fermi_transform(self):
        uxl_data_0 = [
            -19.6268475731047, 18.6229921151091, -17.6693953629138,
            16.7182220035211, -15.7919670482309, 14.8754781258815,
            -13.9748611946433, 13.0855267310788, -12.2091799590797
        ]
        uxl_data_10 = [
            -0.309710530627941, 0.297276179691631, 0.358903419986585,
            -0.241314482851883, -0.400131026972182, 0.177890877835628,
            0.431725549355425, -0.108196471684818, -0.452262578237676
        ]
        uwl_data_8 = [
            -0.179416049057764j, -0.222380421870855, 0.212669675007241j,
            0.189296146549642, -0.0919630698604766j, -0.0141790064888402,
            -0.0787720187062291j, -0.152479503509744, 0.213106209267317j
        ]
    
        basis = IRBasis(1e4, 40, 'fermi')
        xgrid = basis.sampling_points_x(20)
        wgrid = basis.sampling_points_matsubara(20)
        uxl = basis.uxl(np.arange(xgrid.shape[0], dtype=int), xgrid)
        unl = basis.compute_unl(wgrid)
    
>       self.assertTrue(np.allclose(uxl[0, -9:], uxl_data_0))
E       AssertionError: False is not true

test_basis.py:213: AssertionError
=============================== warnings summary ===============================
python/tests/test_basis.py::IRBasisTest::test_bose_grid
python/tests/test_basis.py::IRBasisTest::test_bose_transform
python/tests/test_basis.py::IRBasisTest::test_fermi_grid
python/tests/test_basis.py::IRBasisTest::test_fermi_transform
python/tests/test_basis.py::IRBasisTest::test_init
python/tests/test_basis.py::IRBasisTest::test_init_invalid_ncoeff
python/tests/test_basis.py::IRBasisTest::test_init_notrim_and_raise
python/tests/test_module_functions.py::ModuleFunctionsTest::test_get_fermi_bose_pair_ir
python/tests/test_module_functions.py::ModuleFunctionsTest::test_get_generator_ir
  /home/gharsha/miniconda3/envs/green-devel/lib/python3.12/site-packages/sparse_ir/basis.py:51: UserWarning: xprec package is not available:
  expect single precision (1.5e-8) only as both cutoff and
  accuracy of the basis functions
    warn("xprec package is not available:\n"

python/tests/test_basis.py: 16 warnings
python/tests/test_module_functions.py: 6 warnings
  /home/gharsha/miniconda3/envs/green-devel/lib/python3.12/site-packages/sparse_ir/svd.py:49: DeprecationWarning: `scipy.linalg.interpolative.seed` is deprecated and will be removed in SciPy 1.17.0.
    u, s, v = _idsvd(a_matrix, n_sv=n_sv_hint)

python/tests/test_module_functions.py::ModuleFunctionsTest::test_get_generator_ir
  /home/gharsha/codes/green-grids/python/green_grids/repn/basis.py:31: RuntimeWarning: Bose (Fermi) must have even (odd) points. Using ncoeff=25.
    warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED test_basis.py::IRBasisTest::test_bose_grid - AssertionError: 
FAILED test_basis.py::IRBasisTest::test_bose_transform - AssertionError: Fals...
FAILED test_basis.py::IRBasisTest::test_fermi_grid - AssertionError: 
FAILED test_basis.py::IRBasisTest::test_fermi_transform - AssertionError: Fal...
================== 4 failed, 72 passed, 32 warnings in 2.26s ===================
